# 2048 æ¸¸æˆè¿è¡ŒæŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Dockerï¼ˆæ¨èï¼‰

è¿™æ˜¯æœ€ç®€å•çš„æ–¹å¼ï¼Œä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼š

```bash
# 1. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥æ‚¨çš„ OAuth2 é…ç½®

# 2. å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose -f docker/docker-compose.yml up -d

# 3. è®¿é—®æ¸¸æˆ
# æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:6060
```

### æ–¹æ³•äºŒï¼šå¼€å‘æ¨¡å¼è¿è¡Œ

é€‚åˆå¼€å‘å’Œè°ƒè¯•ï¼š

```bash
# 1. å¯åŠ¨æ•°æ®åº“æœåŠ¡
docker-compose -f docker/docker-compose.yml up -d postgres redis

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶

# 3. å¯åŠ¨åç«¯æœåŠ¡
cd backend
go run cmd/server/main.go

# 4. è®¿é—®æ¸¸æˆ
# æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:6060
```

## ğŸ“‹ å‰ç½®è¦æ±‚

### Docker æ–¹å¼
- Docker
- Docker Compose

### å¼€å‘æ–¹å¼
- Go 1.21+
- Dockerï¼ˆç”¨äºæ•°æ®åº“ï¼‰
- Bunï¼ˆå¯é€‰ï¼Œç”¨äºå‰ç«¯å¼€å‘ï¼‰

## âš™ï¸ é…ç½®è¯´æ˜

### 1. OAuth2 é…ç½®

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œé…ç½® OAuth2 ç™»å½•ï¼š

#### è‡ªå®šä¹‰ OAuth2 æœåŠ¡ï¼ˆæ¨èï¼‰
```env
OAUTH2_PROVIDER=custom
OAUTH2_CLIENT_ID=your_oauth2_client_id
OAUTH2_CLIENT_SECRET=your_oauth2_client_secret
OAUTH2_REDIRECT_URL=http://localhost:6060/auth/callback

# è‡ªå®šä¹‰ OAuth2 ç«¯ç‚¹
OAUTH2_AUTH_URL=https://your-oauth-server.com/oauth/authorize
OAUTH2_TOKEN_URL=https://your-oauth-server.com/oauth/token
OAUTH2_USERINFO_URL=https://your-oauth-server.com/api/user
OAUTH2_SCOPES=openid,profile,email

# ç”¨æˆ·ä¿¡æ¯å­—æ®µæ˜ å°„ï¼ˆæ ¹æ®æ‚¨çš„ OAuth2 å“åº”è‡ªå®šä¹‰ï¼‰
OAUTH2_USER_ID_FIELD=id
OAUTH2_USER_EMAIL_FIELD=email
OAUTH2_USER_NAME_FIELD=name
OAUTH2_USER_AVATAR_FIELD=avatar
```

#### Google OAuth2
```env
OAUTH2_PROVIDER=google
OAUTH2_CLIENT_ID=your_google_client_id
OAUTH2_CLIENT_SECRET=your_google_client_secret
OAUTH2_REDIRECT_URL=http://localhost:6060/auth/callback
```

#### GitHub OAuth2
```env
OAUTH2_PROVIDER=github
OAUTH2_CLIENT_ID=your_github_client_id
OAUTH2_CLIENT_SECRET=your_github_client_secret
OAUTH2_REDIRECT_URL=http://localhost:6060/auth/callback
```

### 2. è·å– OAuth2 å‡­æ®

#### è‡ªå®šä¹‰ OAuth2 æœåŠ¡é…ç½®

**åŸºæœ¬è¦æ±‚ï¼š**
æ‚¨çš„ OAuth2 æœåŠ¡éœ€è¦æ”¯æŒæ ‡å‡†çš„ OAuth2 æˆæƒç æµç¨‹ï¼ŒåŒ…æ‹¬ï¼š

1. **æˆæƒç«¯ç‚¹** (`OAUTH2_AUTH_URL`)ï¼šç”¨æˆ·ç™»å½•å’Œæˆæƒçš„é¡µé¢
2. **ä»¤ç‰Œç«¯ç‚¹** (`OAUTH2_TOKEN_URL`)ï¼šäº¤æ¢æˆæƒç è·å–è®¿é—®ä»¤ç‰Œ
3. **ç”¨æˆ·ä¿¡æ¯ç«¯ç‚¹** (`OAUTH2_USERINFO_URL`)ï¼šè·å–ç”¨æˆ·ä¿¡æ¯çš„ API

**å­—æ®µæ˜ å°„é…ç½®ï¼š**
æ ¹æ®æ‚¨çš„ OAuth2 æœåŠ¡è¿”å›çš„ç”¨æˆ·ä¿¡æ¯æ ¼å¼ï¼Œé…ç½®å­—æ®µæ˜ å°„ï¼š

```env
# å¦‚æœç”¨æˆ·ä¿¡æ¯ API è¿”å›ï¼š
# {
#   "user_id": "12345",
#   "email": "user@example.com",
#   "display_name": "å¼ ä¸‰",
#   "profile_picture": "https://example.com/avatar.jpg"
# }

OAUTH2_USER_ID_FIELD=user_id
OAUTH2_USER_EMAIL_FIELD=email
OAUTH2_USER_NAME_FIELD=display_name
OAUTH2_USER_AVATAR_FIELD=profile_picture
```

**åµŒå¥—å­—æ®µæ”¯æŒï¼š**
æ”¯æŒä½¿ç”¨ç‚¹å·è®¿é—®åµŒå¥—å­—æ®µï¼š

```env
# å¦‚æœç”¨æˆ·ä¿¡æ¯ API è¿”å›ï¼š
# {
#   "id": "12345",
#   "profile": {
#     "name": "å¼ ä¸‰",
#     "avatar": {
#       "url": "https://example.com/avatar.jpg"
#     }
#   }
# }

OAUTH2_USER_ID_FIELD=id
OAUTH2_USER_NAME_FIELD=profile.name
OAUTH2_USER_AVATAR_FIELD=profile.avatar.url
```

**OAuth2 æœåŠ¡ç«¯é…ç½®ï¼š**
åœ¨æ‚¨çš„ OAuth2 æœåŠ¡ä¸­æ·»åŠ é‡å®šå‘ URIï¼š
- å¼€å‘ç¯å¢ƒï¼š`http://localhost:6060/auth/callback`
- ç”Ÿäº§ç¯å¢ƒï¼š`https://yourdomain.com/auth/callback`

#### Google OAuth2
1. è®¿é—® [Google Cloud Console](https://console.cloud.google.com/)
2. åˆ›å»ºæ–°é¡¹ç›®æˆ–é€‰æ‹©ç°æœ‰é¡¹ç›®
3. å¯ç”¨ Google+ API
4. åˆ›å»º OAuth2 å®¢æˆ·ç«¯ ID
5. æ·»åŠ é‡å®šå‘ URIï¼š`http://localhost:6060/auth/callback`

#### GitHub OAuth2
1. è®¿é—® [GitHub Developer Settings](https://github.com/settings/developers)
2. åˆ›å»ºæ–°çš„ OAuth App
3. è®¾ç½® Authorization callback URLï¼š`http://localhost:6060/auth/callback`

## ğŸ® ä½¿ç”¨è¯´æ˜

### æ¸¸æˆè§„åˆ™
- ä½¿ç”¨æ–¹å‘é”®æˆ–æ»‘åŠ¨æ‰‹åŠ¿ç§»åŠ¨æ–¹å—
- ç›¸åŒæ•°å­—çš„æ–¹å—ä¼šåˆå¹¶
- ç›®æ ‡æ˜¯è¾¾åˆ° 8192 æ–¹å—è·å¾—èƒœåˆ©
- æ— æ³•ç§»åŠ¨æ—¶æ¸¸æˆç»“æŸ

### åŠŸèƒ½ç‰¹æ€§
- **å®æ—¶æ¸¸æˆ**ï¼šWebSocket é€šä¿¡ï¼ŒæœåŠ¡å™¨ç«¯æ¸¸æˆé€»è¾‘
- **ç”¨æˆ·è®¤è¯**ï¼šOAuth2 ç™»å½•ç³»ç»Ÿ
- **æ’è¡Œæ¦œ**ï¼šæ—¥æ¦œã€å‘¨æ¦œã€æœˆæ¦œã€æ€»æ¦œ
- **ç§»åŠ¨é€‚é…**ï¼šå“åº”å¼è®¾è®¡ï¼Œæ”¯æŒè§¦æ‘¸æ“ä½œ
- **æ•°æ®æŒä¹…åŒ–**ï¼šæ¸¸æˆè¿›åº¦è‡ªåŠ¨ä¿å­˜

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„
```
game2048/
â”œâ”€â”€ backend/           # Go åç«¯
â”‚   â”œâ”€â”€ cmd/server/    # ä¸»ç¨‹åº
â”‚   â”œâ”€â”€ internal/      # å†…éƒ¨åŒ…
â”‚   â””â”€â”€ pkg/models/    # æ•°æ®æ¨¡å‹
â”œâ”€â”€ frontend/          # å‰ç«¯èµ„æº
â”œâ”€â”€ docker/            # Docker é…ç½®
â””â”€â”€ scripts/           # æ„å»ºè„šæœ¬
```

### å¼€å‘å‘½ä»¤

```bash
# æ„å»ºé¡¹ç›®
./scripts/build.sh

# éƒ¨ç½²é¡¹ç›®
./scripts/deploy.sh

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker/docker-compose.yml logs -f

# åœæ­¢æœåŠ¡
docker-compose -f docker/docker-compose.yml down

# é‡å¯æœåŠ¡
docker-compose -f docker/docker-compose.yml restart
```

### æ•°æ®åº“ç®¡ç†

```bash
# è¿æ¥åˆ° PostgreSQL
docker-compose -f docker/docker-compose.yml exec postgres psql -U postgres -d game2048

# æŸ¥çœ‹æ•°æ®åº“è¡¨
\dt

# æŸ¥çœ‹ç”¨æˆ·æ•°æ®
SELECT * FROM users;

# æŸ¥çœ‹æ¸¸æˆæ•°æ®
SELECT * FROM games ORDER BY score DESC LIMIT 10;
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£è¢«å ç”¨**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   lsof -i :6060
   # ä¿®æ”¹ .env ä¸­çš„ SERVER_PORT
   ```

2. **OAuth2 è®¤è¯å¤±è´¥**
   - æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„å®¢æˆ·ç«¯ ID å’Œå¯†é’¥
   - ç¡®è®¤é‡å®šå‘ URL é…ç½®æ­£ç¡®
   - æ£€æŸ¥ OAuth2 åº”ç”¨çš„åŸŸåè®¾ç½®

3. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
   docker-compose -f docker/docker-compose.yml ps
   # é‡å¯æ•°æ®åº“
   docker-compose -f docker/docker-compose.yml restart postgres
   ```

4. **WebSocket è¿æ¥å¤±è´¥**
   - æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
   - ç¡®è®¤æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ
   - æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose -f docker/docker-compose.yml logs

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose -f docker/docker-compose.yml logs backend
docker-compose -f docker/docker-compose.yml logs postgres

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker/docker-compose.yml logs -f
```

## ğŸŒ ç”Ÿäº§éƒ¨ç½²

### ç¯å¢ƒå˜é‡é…ç½®
```env
# ç”Ÿäº§ç¯å¢ƒé…ç½®
GIN_MODE=release
DEBUG=false
SERVER_HOST=0.0.0.0
DB_SSL_MODE=require

# å®‰å…¨é…ç½®
JWT_SECRET=your-super-secure-jwt-secret-key
CORS_ORIGINS=https://yourdomain.com

# OAuth2 ç”Ÿäº§é…ç½®
OAUTH2_REDIRECT_URL=https://yourdomain.com/auth/callback
```

### HTTPS é…ç½®
å»ºè®®ä½¿ç”¨ Nginx æˆ– Traefik ä½œä¸ºåå‘ä»£ç†ï¼Œé…ç½® SSL è¯ä¹¦ã€‚

### æ€§èƒ½ä¼˜åŒ–
- å¯ç”¨ Redis ç¼“å­˜
- é…ç½®æ•°æ®åº“è¿æ¥æ± 
- ä½¿ç”¨ CDN åŠ é€Ÿé™æ€èµ„æº

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. ç¯å¢ƒå˜é‡é…ç½®æ˜¯å¦æ­£ç¡®
2. æ‰€æœ‰æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
4. æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

ç¥æ‚¨æ¸¸æˆæ„‰å¿«ï¼ğŸ®
